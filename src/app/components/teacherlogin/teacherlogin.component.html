<div class="teacher-dashboard">

  <!-- MOBILE MENU BUTTON -->
  <button class="menu-btn" (click)="toggleTeacherSidebar()">‚ò∞</button>

  <!-- TOP NAVBAR (like admin) -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">TP</div>
      <div class="topbar-title">
        <strong>Teacher Panel</strong>
        <span>Class Manager & Homework</span>
      </div>
     
    </div>
    <div class="topbar-right" *ngIf="loggedInTeacher">
      <div class="top-user">
        {{ loggedInTeacher.name }} ¬∑ {{ loggedInTeacher.Assignclass }}
      </div>
    </div>
    
  </header>

  <div class="layout">
    <!-- SIDEBAR -->
    <aside
      class="sidebar"
      [class.open]="sidebarOpen && isMobile"
      [class.collapsed]="!sidebarOpen && !isMobile">
      <h2>Navigation</h2>

      <div class="nav-group-title">Class</div>
      <div class="nav-item"
           (click)="selectTab('students')"
           [class.active]="activeTab === 'students'">
        <span class="icon">üë®‚Äçüéì</span> <span>Students</span>
      </div>
      <div class="nav-item"
           (click)="selectTab('attendance')"
           [class.active]="activeTab === 'attendance'">
        <span class="icon">üìä</span> <span>Attendance</span>
      </div>

      <div class="nav-group-title">Communication</div>
      <div class="nav-item"
           (click)="selectTab('notices')"
           [class.active]="activeTab === 'notices'">
        <span class="icon">üì¢</span> <span>Notices</span>
      </div>
      <div class="nav-item"
           (click)="selectTab('progress')"
           [class.active]="activeTab === 'progress'">
        <span class="icon">üìù</span> <span>Homework</span>
      </div>

      <div class="nav-group-title">Account</div>
      <div class="nav-item"
           (click)="selectTab('Password')"
           [class.active]="activeTab === 'Password'">
        <span class="icon">üîê</span> <span>Password</span>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main
      class="main"
      [class.expanded]="!sidebarOpen && !isMobile">

      <!-- WELCOME BANNER -->
      <section class="card" *ngIf="loggedInTeacher">
        <div class="welcome-row">
          <div class="welcome-left">
            <img src="assets/teacher.png" class="profile-photo" alt="Teacher Photo">
            <div>
              <h3>Welcome, {{ displayName }} üëã</h3>
              <p class="muted">
                Managing class <strong>{{ loggedInTeacher.Assignclass }}</strong>
              </p>
            </div>
          </div>

          <div class="banner-info">
            <table class="info-table">
              <tr>
                <th>Name</th>
                <td>{{ loggedInTeacher.name }}</td>
              </tr>
              <tr>
                <th>Mobile</th>
                <td>{{ loggedInTeacher.mobileNo }}</td>
              </tr>
              <tr>
                <th>Assigned Class</th>
                <td>{{ loggedInTeacher.Assignclass }}</td>
              </tr>
              <tr>
                <th>Total Students</th>
                <td>{{ students.length }}</td>
              </tr>
            </table>
          </div>
        </div>
      </section>

      <!-- DASHBOARD CARDS -->
      <section class="card">
        <h2>Class Overview</h2>
        <div class="overview-cards">
          <div class="small-card">
            <h3>üë®‚Äçüéì Students</h3>
            <p class="value">{{ students.length }}</p>
            <p class="label">Total Students</p>
          </div>
          <div class="small-card">
            <h3>üì¢ Notices</h3>
            <p class="value">{{ teacherNotices.length }}</p>
            <p class="label">Notices Posted</p>
          </div>
          <div class="small-card">
            <h3>üìù Homework</h3>
            <p class="value">{{ classProgressList.length }}</p>
            <p class="label">Homework Records</p>
          </div>
        </div>
      </section>

      <!-- STUDENTS -->
      <section *ngIf="activeTab === 'students'" class="card">
        <h2>Students ({{ students.length }})</h2>

        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>ID</th>
              <th>Class</th>
              <th>Address</th>
              <th style="width:140px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of students">
              <td>{{ s.name }}</td>
              <td>{{ s.studentId }}</td>
              <td>{{ s.class }}</td>
              <td>{{ s.address }}</td>
              <td>
                <button class="btn btn-primary" (click)="editStudent(s)">Edit</button>
                <button class="btn btn-danger" (click)="deleteStudent(s.studentId)">Delete</button>
              </td>
            </tr>
            <tr *ngIf="students.length === 0">
              <td colspan="5" style="text-align:center;">No students found.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- ATTENDANCE -->
      <section *ngIf="activeTab === 'attendance'" class="card">
        <h2>Attendance</h2>

        <div class="filter-row">
          <button class="btn btn-primary" (click)="markAll('Present')">All Present</button>
          <button class="btn btn-primary" (click)="markAll('Leave')">All Leave</button>
          <button class="btn btn-primary" (click)="markAll('Absent')">All Absent</button>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>ID</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of students">
              <td>{{ s.name }}</td>
              <td>{{ s.studentId }}</td>
              <td>
                <select [(ngModel)]="attendance[s.studentId]">
                  <option value="Present">Present</option>
                  <option value="Leave">Leave</option>
                  <option value="Absent">Absent</option>
                </select>
              </td>
            </tr>
            <tr *ngIf="students.length === 0">
              <td colspan="3" style="text-align:center;">No students to mark.</td>
            </tr>
          </tbody>
        </table>

        <button class="btn btn-primary" (click)="saveAttendance()">Save Attendance</button>
      </section>

      <!-- NOTICES -->
      <section *ngIf="activeTab === 'notices'" class="card">
        <h2>Notices</h2>

        <textarea [(ngModel)]="newNotice.Notice"
                  placeholder="Write notice..."
                  class="full-textarea"></textarea>

        <button class="btn btn-primary" (click)="addNotice()">Post Notice</button>

        <table class="data-table" style="margin-top:14px;">
          <thead>
            <tr>
              <th>Notice</th>
              <th>Class</th>
              <th>By</th>
              <th style="width:140px;">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let n of teacherNotices">
              <td>{{ n.Notice }}</td>
              <td>{{ n.class }}</td>
              <td>{{ n.name }}</td>
              <td>
                <button class="btn btn-primary" (click)="editNotice(n)">Edit</button>
                <button class="btn btn-danger" (click)="deleteNotice(n._id!)">Delete</button>
              </td>
            </tr>
            <tr *ngIf="teacherNotices.length === 0">
              <td colspan="4" style="text-align:center;">No notices yet.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- HOMEWORK / PROGRESS -->
      <section *ngIf="activeTab === 'progress'" class="card">
        <h2>Homework / Progress</h2>

        <div class="filter-row">
          <input type="date" [(ngModel)]="progressDate">
          <input type="text" placeholder="Subject..." [(ngModel)]="progressSubject">
        </div>

        <textarea [(ngModel)]="homeworkText"
                  placeholder="Homework..."
                  class="full-textarea"></textarea>

        <button class="btn btn-primary" (click)="saveClassProgress()">Save Homework</button>

        <div class="history-block" *ngFor="let s of students">
          <h3>{{ s.name }} ‚Äî {{ getProgressForStudent(s.studentId).length }} records</h3>

          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Subject</th>
                <th>Homework</th>
                <th>Status</th>
                <th>Teacher Note</th>
                <th>Score</th>
                <th>Remark</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let p of getProgressForStudent(s.studentId)">
                <td>{{ p.date }}</td>
                <td>{{ p.subject }}</td>
                <td>{{ p.homework }}</td>
                <td>{{ p.status }}</td>
                <td>{{ p.progressNote }}</td>
                <td>{{ p.score || '-' }}</td>
                <td>{{ p.studentRemark || '-' }}</td>
                <td>
                  <button class="btn btn-danger" (click)="deleteProgressRecord(p._id!)">‚úñ</button>
                </td>
              </tr>
              <tr *ngIf="getProgressForStudent(s.studentId).length === 0">
                <td colspan="8" style="text-align:center;">No records.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- CHANGE PASSWORD -->
      <section *ngIf="activeTab === 'Password'" class="card">
        <h2>Change Password</h2>
        <app-user-profile></app-user-profile>
      </section>

    </main>
  </div>
</div>
