<div class="teacher-dashboard">

  <!-- MOBILE MENU BUTTON -->
  <div class="menu-btn" (click)="toggleTeacherSidebar()">â˜° Menu</div>

  <!-- SIDEBAR -->
  <aside class="sidebar" #teacherSidebar id="teacherSidebar">
    <h2>Teacher Panel</h2>

    <!-- REMOVED DASHBOARD TAB -->

    <div class="nav-item" (click)="selectTab('students')" [class.active]="activeTab === 'students'">ğŸ‘¨â€ğŸ“ Students</div>
    <div class="nav-item" (click)="selectTab('attendance')" [class.active]="activeTab === 'attendance'">ğŸ“Š Attendance</div>
    <div class="nav-item" (click)="selectTab('notices')" [class.active]="activeTab === 'notices'">ğŸ“¢ Notices</div>
    <div class="nav-item" (click)="selectTab('progress')" [class.active]="activeTab === 'progress'">ğŸ“ Homework</div>
    <div class="nav-item" (click)="selectTab('Password')" [class.active]="activeTab === 'Password'">ğŸ” Password</div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main" #teacherMainContent>

    <!-- ALWAYS VISIBLE WELCOME BANNER (instead of dashboard tab) -->
    <section class="welcome-banner card" *ngIf="loggedInTeacher">
      <div class="banner-left">
        <img src="assets/teacher.png" class="profile-photo" alt="Teacher Photo">
        <div>
          <h3>Welcome, {{ displayName }} ğŸ‘‹</h3>
          <p>Managing class <strong>{{ loggedInTeacher.Assignclass }}</strong></p>
        </div>
      </div>

      <div class="banner-info">
        <p><strong>Teacher Name:</strong> {{ loggedInTeacher.name }}</p>
        <p><strong>Mobile:</strong> {{ loggedInTeacher.mobileNo }}</p>
        <p><strong>Assigned Class:</strong> {{ loggedInTeacher.Assignclass }}</p>
        <p><strong>Total Students:</strong> {{ students.length }}</p>
      </div>
    </section>

    <!-- ALWAYS VISIBLE DASHBOARD CARDS -->
    <section class="progress-cards">

      <div class="progress-card animate-fade">
        <h3>ğŸ‘¨â€ğŸ“ Students</h3>
        <p class="value">{{ students.length }}</p>
        <p class="label">Total Students</p>
      </div>

      <div class="progress-card animate-up">
        <h3>ğŸ“¢ Notices</h3>
        <p class="value">{{ teacherNotices.length }}</p>
        <p class="label">Notices Posted</p>
      </div>

      <div class="progress-card animate-scale">
        <h3>ğŸ“ Homework</h3>
        <p class="value">{{ classProgressList.length }}</p>
        <p class="label">Homework Records</p>
      </div>

    </section>

    <!-- ====================== STUDENTS ====================== -->
    <section *ngIf="activeTab === 'students'" class="card">
      <h2>Students ({{ students.length }})</h2>

      <div class="students-grid">
        <div class="student-card" *ngFor="let s of students">
          <h3>{{ s.name }}</h3>
          <p><strong>ID:</strong> {{ s.studentId }}</p>
          <p><strong>Class:</strong> {{ s.class }}</p>
          <p><strong>Address:</strong> {{ s.address }}</p>

          <div class="actions">
            <button class="btn primary" (click)="editStudent(s)">Edit</button>
            <button class="btn danger" (click)="deleteStudent(s.studentId)">Delete</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ====================== ATTENDANCE ====================== -->
    <section *ngIf="activeTab === 'attendance'" class="card">
      <h2>Attendance</h2>

      <div class="filters">
        <button class="btn-primary" (click)="markAll('Present')">All Present</button>
        <button class="btn-primary" (click)="markAll('Leave')">All Leave</button>
        <button class="btn-primary" (click)="markAll('Absent')">All Absent</button>
      </div>

      <table class="data-table">
        <thead>
          <tr><th>Name</th><th>ID</th><th>Status</th></tr>
        </thead>

        <tbody>
          <tr *ngFor="let s of students">
            <td>{{ s.name }}</td>
            <td>{{ s.studentId }}</td>
            <td>
              <select [(ngModel)]="attendance[s.studentId]">
                <option value="Present">Present</option>
                <option value="Leave">Leave</option>
                <option value="Absent">Absent</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>

      <button class="btn-primary" (click)="saveAttendance()">Save Attendance</button>
    </section>

    <!-- ====================== NOTICES ====================== -->
    <section *ngIf="activeTab === 'notices'" class="card">
      <h2>Notices</h2>

      <textarea [(ngModel)]="newNotice.Notice" placeholder="Write notice..."></textarea>

      <button class="btn-primary" (click)="addNotice()">Post Notice</button>

      <div class="notice-card" *ngFor="let n of teacherNotices">
        <h3>{{ n.Notice }}</h3>
        <p>Class {{ n.class }} â€” {{ n.name }}</p>

        <div class="actions">
          <button class="btn primary" (click)="editNotice(n)">Edit</button>
          <button class="btn danger" (click)="deleteNotice(n._id!)">Delete</button>
        </div>
      </div>
    </section>

    <!-- ====================== HOMEWORK ====================== -->
    <section *ngIf="activeTab === 'progress'" class="card">
      <h2>Homework / Progress</h2>

      <div class="filters">
        <input type="date" [(ngModel)]="progressDate">
        <input type="text" placeholder="Subject..." [(ngModel)]="progressSubject">
      </div>

      <textarea [(ngModel)]="homeworkText" placeholder="Homework..."></textarea>
      <button class="btn-primary" (click)="saveClassProgress()">Save Homework</button>

      <div class="history-block" *ngFor="let s of students">
        <h3>{{ s.name }} â€” {{ getProgressForStudent(s.studentId).length }} records</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Subject</th>
              <th>Homework</th>
              <th>Status</th>
              <th>Teacher Note</th>
              <th>Score</th>
              <th>Remark</th>
              <th>Delete</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let p of getProgressForStudent(s.studentId)">
              <td>{{ p.date }}</td>
              <td>{{ p.subject }}</td>
              <td>{{ p.homework }}</td>
              <td>{{ p.status }}</td>
              <td>{{ p.progressNote }}</td>
              <td>{{ p.score || '-' }}</td>
              <td>{{ p.studentRemark || '-' }}</td>
              <td>
                <button class="btn danger tiny" (click)="deleteProgressRecord(p._id!)">âœ–</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </section>

    <!-- ====================== CHANGE PASSWORD ====================== -->
    <section *ngIf="activeTab === 'Password'" class="card">
      <h2>Change Password</h2>
      <app-user-profile></app-user-profile>
    </section>

  </main>
</div>
