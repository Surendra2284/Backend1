<div class="student-dashboard">

  <!-- MOBILE MENU BUTTON -->
 <div class="menu-btn" (click)="toggleStudentSidebar()">â˜° Menu</div>

<!-- SIDEBAR -->
<aside class="sidebar" #studentSidebar id="studentSidebar">
  <h2>Student Panel</h2>

  <div class="nav-item" (click)="selectTab('dashboard')" [class.active]="activeTab === 'dashboard'">ğŸ  Dashboard</div>
  <div class="nav-item" (click)="selectTab('homework')" [class.active]="activeTab === 'homework'">ğŸ“˜ Homework</div>
  <div class="nav-item" (click)="selectTab('attendance')" [class.active]="activeTab === 'attendance'">ğŸ“Š Attendance</div>
  <div class="nav-item" (click)="selectTab('notices')" [class.active]="activeTab === 'notices'">ğŸ“¢ Notices</div>
  <div class="nav-item" (click)="selectTab('Password')" [class.active]="activeTab === 'Password'">ğŸ” Change Password</div>
</aside>
  
    

  <!-- MAIN CONTENT -->
  <main class="main" #studentMainContent>

    <!-- =====================================================
         DASHBOARD TAB â€” Welcome + Progress Cards
    ========================================================-->
    <section *ngIf="activeTab === 'dashboard'" >

      <!-- WELCOME BANNER -->
      <section class="welcome-banner card" *ngIf="student">
        <div class="banner-left">
          <img [src]="student.photo" class="profile-photo" alt="Student Photo">
          <div>
            <h1>Welcome, {{ student.name }} ğŸ‘‹</h1>
            <p>Fee Update, {{ student.Notice }}.</p>
          </div>
        </div>

        <div class="banner-info">
          <p><strong>Student ID:</strong> {{ student.studentId }}</p>
          <p><strong>Class:</strong> {{ student.class }}</p>
          <p><strong>Class Teacher:</strong> {{ student.classteacher }}</p>
          <p><strong>Attendance Summary:</strong> {{ attendanceSummary }}</p>
        </div>
      </section>

      <!-- PROGRESS CARDS -->
      <div class="progress-cards">

        <div class="progress-card animate-fade">
          <h3>ğŸ“… Attendance</h3>
          <p class="value">{{ attendancePercent }}%</p>
          <p class="label">Overall Attendance</p>
        </div>

        <div class="progress-card animate-up">
          <h3>ğŸ“˜ Homework</h3>
          <p class="value">{{ homeworkDonePercent }}%</p>
          <p class="label">Completed Tasks</p>
        </div>

        <div class="progress-card animate-scale">
          <h3>ğŸ“¢ Notices</h3>
          <p class="value">{{ notices.length }}</p>
          <p class="label">New Notices</p>
        </div>

      </div>

    </section>

    <!-- =====================================================
          HOMEWORK SECTION
    ========================================================-->
    <section *ngIf="activeTab === 'homework'" class="card">
      <h2>My Homework & Progress</h2>

      <div class="filters">
        <input type="date" [(ngModel)]="fromDate">
        <input type="date" [(ngModel)]="toDate">
        <input type="text" placeholder="Filter by subject" [(ngModel)]="subjectFilter">
        <button class="btn-primary" (click)="loadMyProgress()">Search</button>
      </div>

      <table class="data-table" *ngIf="myProgressList.length; else noHomework">
        <thead>
          <tr>
            <th>Date</th>
            <th>Subject</th>
            <th>Homework</th>
            <th>Teacher Note</th>
            <th>Status</th>
            <th>Remark</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let p of myProgressList">
            <td>{{ p.date }}</td>
            <td>{{ p.subject }}</td>
            <td>{{ p.homework }}</td>
            <td>{{ p.progressNote }}</td>
            <td><span class="status">{{ p.status }}</span></td>

            <td>
              <input [(ngModel)]="remarkMap[p._id!]" placeholder="Add remarkâ€¦">
              <small *ngIf="p.studentRemarkDate">(Updated: {{ p.studentRemarkDate }})</small>
            </td>

            <td>
             <button 
  class="btn-primary" 
  (click)="markHomeworkDone(p)" 
  *ngIf="p.status !== 'Completed'">
  Mark Done
</button>

<span class="done-label" *ngIf="p.status === 'Completed'">
  âœ” Done
</span>
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #noHomework>
        <p class="empty">No homework available.</p>
      </ng-template>

      <p class="message" *ngIf="message">{{ message }}</p>
    </section>

    <!-- =====================================================
          ATTENDANCE
    ========================================================-->
    <section *ngIf="activeTab === 'attendance'" class="card">
      <h2>Attendance</h2>

      <table class="data-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let record of attendanceRecords">
            <td>{{ record.date }}</td>
            <td class="status-{{ record.status | lowercase }}">{{ record.status }}</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- =====================================================
          NOTICES
    ========================================================-->
    <section *ngIf="activeTab === 'notices'" class="card">
      <h2>Class Notices</h2>

      <div *ngIf="notices.length; else noNotices">
        <div class="notice-card" *ngFor="let notice of notices">
          <h3>{{ notice.title }}</h3>
          <p>{{ notice.message }}</p>
          <small>By {{ notice.name }}</small>
        </div>
      </div>

      <ng-template #noNotices>
        <p class="empty">No notices posted yet.</p>
      </ng-template>
    </section>

    <!-- =====================================================
          PASSWORD
    ========================================================-->
    <section *ngIf="activeTab === 'Password'" class="card">
      <h2>Change Password</h2>
      <app-user-profile></app-user-profile>
    </section>

  </main>
</div>

<!-- UPDATED SIDEBAR CONTROL SCRIPT -->
<script>
  function toggleStudentSidebar() {
    const sidebar = document.getElementById("studentSidebar");

    if (window.innerWidth <= 768) {
      sidebar.classList.toggle("open");
    } else {
      sidebar.classList.toggle("collapsed");
      document.getElementById("studentMainContent").classList.toggle("expanded");
    }
  }
</script>
